<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="gnrl">



	<select id="gnrl.cart.selectCartList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT
			X.RN,
			X.TOT_CNT,
			X.CART_SN,
			X.GOODS_CODE,
			FN_PURCHS_AMOUNT(X.ESNTL_ID, X.CART_SN) AS PURCHS_AMOUNT,
			X.TOUR_DE,
			X.BEGIN_TIME,
			X.END_TIME,
			X.GOODS_NM,
			X.FILE_CODE,
			X.WAIT_TIME,
			X.MVMN_TIME,
			X.WRITNG_ID,
			X.WRITNG_DE,
			X.CHKIN_DE,
			X.CHCKT_DE,
			X.DIFF_DAYS
		FROM
		(
			SELECT A.*,
			ROWNUM AS RN, COUNT(*) OVER() AS TOT_CNT
			FROM
			(
				SELECT
					CG.ESNTL_ID,
					CG.CART_SN,
					CG.GOODS_CODE,
					CG.TOUR_DE,
					CG.BEGIN_TIME,
					CG.END_TIME,
					G.GOODS_NM,
					G.FILE_CODE,
					G.WAIT_TIME,
					G.MVMN_TIME,
					CG.WRITNG_ID,
					TO_CHAR(CG.WRITNG_DT,'YYYY-MM-DD') WRITNG_DE,
					CG.CHKIN_DE,
					CG.CHCKT_DE,
					DECODE(CG.TOUR_DE, NULL, TO_DATE(CG.CHCKT_DE, 'YYYYMMDD') - TO_DATE(CG.CHKIN_DE, 'YYYYMMDD'), '', TO_DATE(CG.CHCKT_DE, 'YYYYMMDD') - TO_DATE(CG.CHKIN_DE, 'YYYYMMDD'), 0 ) DIFF_DAYS
				FROM TB_CART_GOODS CG
				INNER JOIN TB_GOODS G ON G.GOODS_CODE = CG.GOODS_CODE AND G.DELETE_AT = 'N'
				WHERE CG.ESNTL_ID = #esntl_id#
				AND CG.EXPRTN_AT = 'N'
				ORDER BY CG.WRITNG_DT DESC

			) A
		) X
		WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		ORDER BY RN ASC
	</select>









	





	
















</sqlMap>
