<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="mngr">
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="string" type="java.lang.String"/>

    <insert id="MngrDAO.insertMngr" parameterClass="hashMap">
    <![CDATA[
        INSERT INTO TB_MNGR ( ESNTL_ID
                            , MNGR_ID
                            , MNGR_NM
                            , PASSWORD
                            , CMPNY_CODE
                            , AUTHOR_CL
                            , CONFM_AT
                            , WRITNG_ID
                            , WRITNG_DT )
                     VALUES ( 'MNGR'||LPAD(SQ_ESNTL_ID.NEXTVAL, 16, '0')
                            , #MNGR_ID#
                            , #MNGR_NM#
                            , #PASSWORD#
                            , #CMPNY_CODE#
                            , #AUTHOR_CL#
                            , NVL(#CONFM_AT#, 'N')
                            , #WRITNG_ID#
                            , SYSDATE )
    ]]>
    </insert>

    <update id="MngrDAO.updateMngr" parameterClass="hashMap">
    <![CDATA[
        UPDATE TB_MNGR
           SET PASSWORD = #PASSWORD#
             , AUTHOR_CL = #AUTHOR_CL#
             , CMPNY_CODE = #CMPNY_CODE#
             , UPDT_ID = #UPDT_ID#
             , UPDT_DT = SYSDATE
         WHERE ESNTL_ID = #ESNTL_ID#
    ]]>
    </update>

    <delete id="MngrDAO.deleteMngr" parameterClass="hashMap">
    <![CDATA[
        UPDATE TB_MNGR
           SET DELETE_AT = 'Y'
             , UPDT_ID = #UPDT_ID#
             , UPDT_DT = SYSDATE
         WHERE CMPNY_CODE = #CMPNY_CODE#
    ]]>
    </delete>

    <update id="MngrDAO.confrmMngr" parameterClass="hashMap">
<![CDATA[
        UPDATE TB_MNGR
           SET CONFM_AT = #CONFM_AT#
             , UPDT_ID = #UPDT_ID#
             , UPDT_DT = SYSDATE
         WHERE ESNTL_ID = #ESNTL_ID#
    ]]>
</update>

    <select id="MngrDAO.selectMngrByPk" parameterClass="hashMap" resultClass="hashMap">
    <![CDATA[
        SELECT ESNTL_ID
             , MNGR_ID
             , MNGR_NM
             , PASSWORD
             , AUTHOR_CL
             , CMPNY_CODE
             , (SELECT CMPNY_NM FROM TB_TOUR_CMPNY X WHERE A.CMPNY_CODE = X.CMPNY_CODE) CMPNY_NM
             , CONFM_AT
             , WRITNG_ID
             , TO_CHAR(WRITNG_DT,'YYYY-MM-DD') WRITNG_DE
             , UPDT_ID
             , TO_CHAR(UPDT_DT,'YYYY-MM-DD') UPDT_DE
          FROM TB_MNGR A
         WHERE ESNTL_ID = #ESNTL_ID#
    ]]>
    </select>

    <sql id="Mngr.sqlPagePre">
        SELECT T2.*
          FROM (SELECT T1.*
                     , ROWNUM AS RN
                     , COUNT(1) OVER() AS TOT_CNT
                  FROM (
    </sql>

    <sql id="Mngr.sqlPagePost">
                       ) T1
               ) T2
         WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
         ORDER BY RN
    </sql>

    <select id="MngrDAO.selectMngrList" parameterClass="hashMap" resultClass="hashMap">
    <include refid="Mngr.sqlPagePre"/>
    <![CDATA[
        SELECT ESNTL_ID
             , MNGR_ID
             , MNGR_NM
             , PASSWORD
             , AUTHOR_CL
             , CMPNY_CODE
             , (SELECT CMPNY_NM FROM TB_TOUR_CMPNY X WHERE A.CMPNY_CODE = X.CMPNY_CODE) CMPNY_NM
             , CONFM_AT
             , WRITNG_ID
             , TO_CHAR(WRITNG_DT,'YYYY-MM-DD') WRITNG_DE
             , UPDT_ID
             , TO_CHAR(UPDT_DT,'YYYY-MM-DD') UPDT_DE
          FROM TB_MNGR A
         WHERE 1 = 1
    ]]>
        <isNotEmpty property="SCH_MNGR_NM">
          AND MNGR_NM LIKE #SCH_MNGR_NM#||'%'
        </isNotEmpty>
        <isNotEmpty property="SCH_AUTHOR_CL">
          AND AUTHOR_CL = #SCH_AUTHOR_CL#
        </isNotEmpty>
        <isNotEmpty property="SCH_CONFM_AT">
          AND CONFM_AT = #SCH_CONFM_AT#
        </isNotEmpty>
        ORDER BY ESNTL_ID
    <include refid="Mngr.sqlPagePost"/>
    </select>

    <select id="MngrDAO.selectMngrIdForDup" parameterClass="hashMap" resultClass="string">
    <![CDATA[
        SELECT DECODE(SIGN(COUNT(MNGR_ID)), 0, 'N', 'Y') AS CL_DUP_AT
          FROM TB_MNGR A
         WHERE MNGR_ID = #MNGR_ID#
    ]]>
    </select>
</sqlMap>