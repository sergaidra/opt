<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="mngr">
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="string" type="java.lang.String"/>

    <insert id="GoodsDAO.insertGoods" parameterClass="hashMap">
    <selectKey keyProperty="GOODS_CODE" resultClass="string">
        SELECT LPAD(SQ_GOODS_CODE.NEXTVAL, 10, '0') FROM DUAL
    </selectKey>
    <![CDATA[
        INSERT INTO TB_GOODS( GOODS_CODE
                            , GOODS_NM
                            , GOODS_INTRCN
                            , WAIT_TIME
                            , MVMN_TIME
                            , DELETE_AT
                            , LA
                            , LO
                            , WRITNG_ID
                            , WRITNG_DT
                            , FILE_CODE )
                      VALUES( #GOODS_CODE#
                            , #GOODS_NM#
                            , #GOODS_INTRCN:CLOB#
                            , #WAIT_HH#||#WAIT_MI#
                            , #MVMN_HH#||#MVMN_MI#
                            , 'N'
                            , #LA#
                            , #LO#
                            , #WRITNG_ID#
                            , SYSDATE
                            , #FILE_CODE# )
    ]]>
    </insert>

    <update id="GoodsDAO.updateGoods" parameterClass="hashMap">
    <![CDATA[
        UPDATE TB_GOODS
           SET CL_NM = #CL_NM#
             , FILE_CODE = #FILE_CODE#
             , UPDT_ID = #UPDT_ID#
             , UPDT_DT = SYSDATE
         WHERE CL_CODE = #CL_CODE#
    ]]>
    </update>

    <delete id="GoodsDAO.deleteGoods" parameterClass="hashMap">
    <![CDATA[
        UPDATE TB_GOODS
           SET DELETE_AT = 'Y'
             , UPDT_ID = #UPDT_ID#
             , UPDT_DT = SYSDATE
         WHERE CL_CODE = #CL_CODE#
    ]]>
    </delete>

    <select id="GoodsDAO.selectGoodsByPk" parameterClass="hashMap" resultClass="hashMap">
    <![CDATA[
        SELECT GOODS_CODE
             , GOODS_NM
             , GOODS_INTRCN
             , DELETE_AT
             , FILE_CODE
             , WRITNG_ID
             , TO_CHAR(WRITNG_DT,'YYYY-MM-DD') WRITNG_DE
             , UPDT_ID
             , TO_CHAR(UPDT_DT,'YYYY-MM-DD') UPDT_DE
          FROM TB_GOODS
         WHERE GOODS_CODE = #GOODS_CODE#
    ]]>
    </select>

    <select id="GoodsDAO.selectGoodsList" parameterClass="hashMap" resultClass="hashMap">
    <![CDATA[
        SELECT A.GOODS_CODE
             , A.GOODS_NM
             , A.GOODS_INTRCN
             , A.DELETE_AT
             , A.WRITNG_ID
             , TO_CHAR(A.WRITNG_DT,'YYYY-MM-DD') WRITNG_DE
             , A.UPDT_ID
             , TO_CHAR(A.UPDT_DT,'YYYY-MM-DD') UPDT_DE
             , A.FILE_CODE
             , A.LA
             , A.LO
             , (SELECT C.CL_NM 
                  FROM TB_GOODS_CL B, TB_TOUR_CL C 
                 WHERE A.GOODS_CODE = B.GOODS_CODE 
                   AND B.CL_CODE = C.CL_CODE 
                   AND ROWNUM = 1) CL_NM
          FROM TB_GOODS A
         WHERE 1 = 1    ]]>
        <isNotEmpty property="DELETE_AT">
          AND DELETE_AT = #DELETE_AT#
        </isNotEmpty>
         ORDER BY WRITNG_DT, GOODS_CODE
    </select>

</sqlMap>