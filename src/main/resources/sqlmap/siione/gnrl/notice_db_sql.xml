<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="gnrl">

	<typeAlias alias="hashMap" type="java.util.HashMap"/>
	<typeAlias alias="int" type="java.lang.Integer"/>

	<insert id="gnrl.notice.insertBbs" parameterClass="hashMap">
		INSERT INTO TB_BBS (BBS_SN, CATEGORY, SUBJECT, CONTENTS, WRITNG_ID, WRITNG_DT, VIEWCNT, DELETE_AT, SECRET_AT
			, SUBCATEGORY, PARENT_BBS_SN)
		SELECT NVL(MAX(BBS_SN), 0) + 1, #category#, #subject#, #contents#, #esntl_id#, SYSDATE, 0, 'N', 'N'
			, #subcategory#, #parent_bbs_sn#
		FROM TB_BBS
	</insert>	

	<update id="gnrl.notice.deleteBbs" parameterClass="hashMap">
		UPDATE TB_BBS SET DELETE_AT = 'Y'
		WHERE BBS_SN = #bbs_sn#
	</update>	

	<update id="gnrl.notice.updateBbs" parameterClass="hashMap">
		UPDATE TB_BBS SET SUBJECT = #subject#, CONTENTS = #contents#, UPDT_ID = #esntl_id#, UPDT_DT = SYSDATE, SECRET_AT = 'N'
			, SUBCATEGORY = #subcategory#
		WHERE BBS_SN = #bbs_sn#
	</update>	
	
	<select id="gnrl.notice.viewBbs"  parameterClass="hashMap" resultClass="hashMap">
		SELECT B.BBS_SN, B.CATEGORY, B.SUBJECT, B.CONTENTS, B.WRITNG_ID, B.VIEWCNT
			, U.USER_NM AS USER_NM, SECRET_AT, U.EMAIL AS EMAIL, TO_CHAR(B.WRITNG_DT, 'YYYY-MM-DD') AS WRITNG_DT 
			, B.SUBCATEGORY
		FROM TB_BBS B
			INNER JOIN TB_USER U ON B.WRITNG_ID = U.ESNTL_ID
		WHERE B.BBS_SN = #bbs_sn#
	</select>
		
</sqlMap>
