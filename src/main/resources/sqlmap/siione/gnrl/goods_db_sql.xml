<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'> 
<sqlMap namespace="gnrl">

	<select id="gnrl.goods.selectTourClList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap"> 
		SELECT  
		TT.CL_CODE,
		TT.CL_NM,
		TT.FILE_CODE,
		TT.DELETE_AT,
		TT.WRITNG_ID,
		TT.WRITNG_DE,
		TT.UPDT_ID,
		TT.UPDT_DE,
		(SELECT COUNT(*) FROM TB_GOODS_CL TG WHERE TG.CL_CODE = TT.CL_CODE) AS GOODS_CNT
		FROM TB_TOUR_CL TT
		WHERE TT.DELETE_AT = 'N'
	    <isNotEmpty property="cl_code_arr" prepend="AND">
			TT.CL_CODE IN
			<iterate property="cl_code_arr" open=" (" conjunction="," close=")">
				#cl_code_arr[]#
			</iterate>
		</isNotEmpty>
		ORDER BY TT.CL_NM ASC	
	</select>

	<select id="gnrl.goods.selectTourClDetail" parameterClass="java.util.HashMap" resultClass="java.util.HashMap"> 
		SELECT  
		TT.CL_CODE,
		TT.CL_NM,
		TT.FILE_CODE,
		TT.DELETE_AT,
		TT.WRITNG_ID,
		TT.WRITNG_DE,
		TT.UPDT_ID,
		TT.UPDT_DE,
		(SELECT COUNT(*) FROM TB_GOODS_CL TG WHERE TG.CL_CODE = TT.CL_CODE) AS GOODS_CNT
		FROM TB_TOUR_CL TT
		WHERE TT.DELETE_AT = 'N'
		AND TT.CL_CODE = #cl_code#
	</select>

	<select id="gnrl.goods.selectGoodsList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap"> 
		SELECT  
		TG.GOODS_CODE,
		TG.GOODS_NM,
		TG.GOODS_INTRCN,
		TG.DELETE_AT,
		TG.FILE_CODE,
		(
			SELECT 
			FD.FILE_SN
			FROM TB_FILE_DETAIL FD		
			WHERE FD.FILE_CODE = TG.FILE_CODE AND FD.REPRSNT_AT = 'Y'
			AND ROWNUM = 1
		) AS FILE_SN,
		TG.WRITNG_ID,
		TG.WRITNG_DE,
		TG.UPDT_ID,
		TG.UPDT_DE
		FROM TB_GOODS TG
		WHERE TG.DELETE_AT = 'N'
		AND EXISTS (
		    SELECT * FROM TB_GOODS_CL TGC
		    WHERE TGC.GOODS_CODE = TG.GOODS_CODE
		    <isNotEmpty property="cl_code_arr" prepend="AND">
				TGC.CL_CODE IN
				<iterate property="cl_code_arr" open=" (" conjunction="," close=")">
					#cl_code_arr[]#
				</iterate>
			</isNotEmpty>
		)
		ORDER BY TG.WRITNG_DE DESC
	</select>

	<select id="gnrl.goods.selectGoodsDetail" parameterClass="java.util.HashMap" resultClass="java.util.HashMap"> 
		SELECT  
		TG.GOODS_CODE,
		TG.GOODS_NM,
		TG.GOODS_INTRCN,
		TG.DELETE_AT,
		TG.FILE_CODE,
		TG.WRITNG_ID,
		TG.WRITNG_DE,
		TG.UPDT_ID,
		TG.UPDT_DE
		FROM TB_GOODS TG
		WHERE TG.DELETE_AT = 'N'
		AND TG.GOODS_CODE = #goods_code#
	</select>


</sqlMap>