<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'> 
<sqlMap namespace="gnrl">

	<select id="gnrl.mber.selectUserInfo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap"> 
	    SELECT
		ESNTL_ID,
		USER_ID,
		USER_NM,
		WRITNG_ID,
		WRITNG_DE,
		UPDT_ID,
		UPDT_DE,
		PASSWORD
	    FROM TB_USER
		WHERE USER_ID = #user_id#		
	</select>

	<insert id="gnrl.mber.insertUserLog" parameterClass="HashMap">
		INSERT INTO TB_USER_CONECT_HIST(
			CONECT_INNB,
			ESNTL_ID,
			CONECT_IP,
			CONECT_DT
		) VALUES(
			(
				SELECT TO_CHAR(SYSDATE,'YYYY') || LPAD(NVL(MAX(CONECT_INNB),0)+1, 16, '0') 
				FROM TB_USER_CONECT_HIST 
				WHERE TO_CHAR(CONECT_DT,'YYYY') = TO_CHAR(SYSDATE,'YYYY')
			),
			#esntl_id#,
			#connect_ip#,
			SYSDATE
		)
	</insert>

	<select id="gnrl.mber.selectEsntlID" resultClass="String">
		SELECT 'GNRL' || LPAD(SQ_ESNTL_ID.NEXTVAL, 16, '0') FROM DUAL
	</select>

	<insert id="gnrl.mber.insertUser" parameterClass="HashMap">
		INSERT INTO TB_USER(
			ESNTL_ID,
			USER_ID,
			USER_NM,
			WRITNG_ID,
			WRITNG_DE,
			PASSWORD
		) VALUES(
			#esntl_id#,
			#user_id#,
			#user_nm#,
			#user_id#,
			TO_CHAR(SYSDATE,'yyyymmdd'),
			#password#
		)
	</insert>
	
</sqlMap>